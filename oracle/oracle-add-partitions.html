<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggiungere Partizioni Mensili | Oracle Database</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../appunti-style.css">
    <link rel="stylesheet" href="../dark-mode.css">
</head>
<body>
    <!-- PULSANTE DARK MODE -->
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="Cambia tema">
        üåô
    </button>

    <!-- Menu Hamburger -->
    <div class="hamburger" id="hamburger">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
    </div>

    <!-- Menu Laterale -->
    <nav class="sidebar" id="sidebar">
        <div class="close-btn" id="closeBtn">&times;</div>
        <ul class="menu">
            <li><a href="../index.html">üè† Home</a></li>
            <li><a href="../sas-programming.html">üìä SAS Programming</a></li>
            <li><a href="../oracle.html">üî¥ Oracle Database</a></li>
            <li><a href="../utility.html">üõ†Ô∏è Utility & Tools</a></li>
            <li><a href="../linux.html">üêß Linux & Shell</a></li>
        </ul>
    </nav>

    <!-- Contenuto -->
    <main class="content note-detail">
        <a href="../oracle.html" class="back-link">‚Üê Torna a Oracle Database</a>

        <div class="note-header">
            <h1>Aggiungere Partizioni Mensili a Tabella</h1>
            <div class="note-meta">
                <span>üìÅ Categoria: <strong>DDL / Partitioning</strong></span>
                <span>üìÖ Aggiornato: <strong>12 Dicembre 2024</strong></span>
                <span>‚è±Ô∏è Lettura: <strong>8 min</strong></span>
            </div>
            <div class="card-tags">
                <span class="tag">alter table</span>
                <span class="tag">partition</span>
                <span class="tag">list</span>
                <span class="tag">mensile</span>
            </div>
        </div>

        <!-- Descrizione -->
        <div class="note-section">
            <h2>üìã Descrizione</h2>
            <p>
                Questo appunto mostra come <strong>aggiungere partizioni mensili</strong> a una tabella Oracle 
                gi√† partizionata, usando il comando <code>ALTER TABLE ... ADD PARTITION</code>.
            </p>
            <p>
                Le partizioni permettono di dividere grandi tabelle in segmenti pi√π piccoli per migliorare:
            </p>
            <ul>
                <li><strong>Performance delle query</strong> (partition pruning)</li>
                <li><strong>Manutenzione</strong> (backup/restore per singola partizione)</li>
                <li><strong>Gestione dati storici</strong> (drop partizioni vecchie)</li>
            </ul>
        </div>

        <!-- Codice Completo -->
        <div class="note-section">
            <h2>üíª Codice Completo</h2>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Partizioni per il 2024</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202409 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202409'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202410 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202410'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202411 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202411'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202412 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202412'</span>);

<span class="sql-comment">-- Partizioni per il 2025</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202501 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202501'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202502 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202502'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202503 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202503'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202504 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202504'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202505 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202505'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202506 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202506'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202507 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202507'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202508 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202508'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202509 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202509'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202510 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202510'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202511 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202511'</span>);
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ADD PARTITION</span> TAB1_202512 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202512'</span>);</code></pre>
            </div>
        </div>

        <!-- Come Funziona -->
        <div class="note-section">
            <h2>üîç Come Funziona</h2>

            <h3>Sintassi:</h3>
            <div class="code-block">
                <pre><code><span class="sql-keyword">ALTER TABLE</span> nome_tabella 
<span class="sql-keyword">ADD PARTITION</span> nome_partizione 
<span class="sql-keyword">VALUES</span> (valore_partizione);</code></pre>
            </div>

            <h3>Componenti:</h3>
            <div class="options-list">
                <div class="option-item">
                    <div class="option-name">ALTER TABLE TAB1</div>
                    <div class="option-description">
                        Modifica la struttura della tabella <code>TAB1</code><br>
                        La tabella deve essere gi√† partizionata (LIST PARTITION)
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-name">ADD PARTITION TAB1_202409</div>
                    <div class="option-description">
                        Aggiunge una nuova partizione chiamata <code>TAB1_202409</code><br>
                        Convenzione nome: <code>TABELLA_YYYYMM</code> (anno + mese)<br>
                        Esempio: TAB1_202409 = Settembre 2024
                    </div>
                </div>

                <div class="option-item">
                    <div class="option-name">VALUES ('202409')</div>
                    <div class="option-description">
                        <strong>Valore della chiave di partizione</strong><br>
                        I record con questo valore nella colonna di partizione andranno in questa partizione<br>
                        <code>'202409'</code> = Stringa che rappresenta Settembre 2024<br>
                        Formato: <code>YYYYMM</code> (anno a 4 cifre + mese a 2 cifre)
                    </div>
                </div>
            </div>

            <h3>Prerequisiti:</h3>
            <p>Questo comando funziona solo se la tabella √® stata creata con LIST PARTITION. Esempio:</p>
            <div class="code-block">
                <pre><code><span class="sql-keyword">CREATE TABLE</span> TAB1 (
    id <span class="sql-keyword">NUMBER</span>,
    data_riferimento <span class="sql-keyword">VARCHAR2</span>(<span class="sql-number">6</span>),
    descrizione <span class="sql-keyword">VARCHAR2</span>(<span class="sql-number">100</span>)
)
<span class="sql-keyword">PARTITION BY LIST</span> (data_riferimento) (
    <span class="sql-keyword">PARTITION</span> TAB1_202401 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202401'</span>),
    <span class="sql-keyword">PARTITION</span> TAB1_202402 <span class="sql-keyword">VALUES</span> (<span class="sql-string">'202402'</span>)
);</code></pre>
            </div>
        </div>

        <!-- Esempio Pratico -->
        <div class="note-section">
            <h2>üéì Esempio Pratico</h2>

            <h3>Scenario:</h3>
            <p>
                Hai una tabella <code>TAB1</code> partizionata per mese che attualmente ha partizioni 
                fino ad Agosto 2024. Vuoi aggiungere partizioni per il resto del 2024 e tutto il 2025.
            </p>

            <h3>Passo 1: Verifica partizioni esistenti</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">SELECT</span> partition_name, high_value
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
<span class="sql-keyword">ORDER BY</span> partition_position;</code></pre>
            </div>

            <h3>Output esempio:</h3>
            <div class="code-block">
                <pre><code>PARTITION_NAME    HIGH_VALUE
--------------    ----------
TAB1_202401       '202401'
TAB1_202402       '202402'
TAB1_202403       '202403'
...
TAB1_202408       '202408'</code></pre>
            </div>

            <h3>Passo 2: Aggiungi nuove partizioni</h3>
            <p>Esegui gli ALTER TABLE per settembre-dicembre 2024 e gennaio-dicembre 2025.</p>

            <h3>Passo 3: Verifica creazione</h3>
            <div class="code-block">
                <pre><code><span class="sql-keyword">SELECT</span> partition_name, high_value, num_rows
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
  <span class="sql-keyword">AND</span> partition_name <span class="sql-keyword">LIKE</span> <span class="sql-string">'%2024%'</span>
<span class="sql-keyword">ORDER BY</span> partition_position;</code></pre>
            </div>

            <h3>Passo 4: Inserisci dati</h3>
            <div class="code-block">
                <pre><code><span class="sql-comment">-- I dati vanno automaticamente nella partizione corretta</span>
<span class="sql-keyword">INSERT INTO</span> TAB1 (id, data_riferimento, descrizione)
<span class="sql-keyword">VALUES</span> (<span class="sql-number">1</span>, <span class="sql-string">'202409'</span>, <span class="sql-string">'Dati Settembre 2024'</span>);

<span class="sql-comment">-- Questa riga va nella partizione TAB1_202409</span></code></pre>
            </div>
        </div>

        <!-- Vantaggi Partitioning -->
        <div class="note-section">
            <h2>‚úÖ Vantaggi del Partitioning</h2>

            <h3>1. Performance - Partition Pruning</h3>
            <p>Oracle scansiona solo le partizioni necessarie:</p>
            <div class="code-block">
                <pre><code><span class="sql-comment">-- Query su un solo mese</span>
<span class="sql-keyword">SELECT</span> *
<span class="sql-keyword">FROM</span> TAB1
<span class="sql-keyword">WHERE</span> data_riferimento = <span class="sql-string">'202409'</span>;

<span class="sql-comment">-- Oracle scansiona SOLO la partizione TAB1_202409!</span>
<span class="sql-comment">-- Ignora tutte le altre partizioni ‚Üí query molto pi√π veloce</span></code></pre>
            </div>

            <h3>2. Manutenzione Semplificata</h3>
            <div class="code-block">
                <pre><code><span class="sql-comment">-- Cancella dati vecchi (tutto gennaio 2024)</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">DROP PARTITION</span> TAB1_202401;

<span class="sql-comment">-- Backup di una singola partizione</span>
<span class="sql-keyword">expdp</span> user/pwd tables=TAB1:TAB1_202412 dumpfile=dic2024.dmp</code></pre>
            </div>

            <h3>3. Gestione Storage</h3>
            <p>Puoi mettere partizioni diverse su tablespace diversi:</p>
            <div class="code-block">
                <pre><code><span class="sql-comment">-- Partizioni vecchie su storage economico</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">MOVE PARTITION</span> TAB1_202401 
<span class="sql-keyword">TABLESPACE</span> archivio_storage;

<span class="sql-comment">-- Partizioni recenti su storage veloce (SSD)</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">MOVE PARTITION</span> TAB1_202412 
<span class="sql-keyword">TABLESPACE</span> fast_storage;</code></pre>
            </div>

            <h3>4. Query Parallele</h3>
            <p>Oracle pu√≤ processare partizioni diverse in parallelo:</p>
            <div class="code-block">
                <pre><code><span class="sql-comment">-- Query su tutto l'anno 2024 in parallelo</span>
<span class="sql-keyword">SELECT</span> <span class="sql-comment">/*+ PARALLEL(4) */</span> 
       data_riferimento, <span class="sql-keyword">COUNT</span>(*)
<span class="sql-keyword">FROM</span> TAB1
<span class="sql-keyword">WHERE</span> data_riferimento <span class="sql-keyword">BETWEEN</span> <span class="sql-string">'202401'</span> <span class="sql-keyword">AND</span> <span class="sql-string">'202412'</span>
<span class="sql-keyword">GROUP BY</span> data_riferimento;</code></pre>
            </div>
        </div>

        <!-- Varianti -->
        <div class="note-section">
            <h2>üîß Varianti e Altre Operazioni</h2>

            <h3>1Ô∏è‚É£ Aggiungere Partizione con Tablespace Specifico</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">ALTER TABLE</span> TAB1 
<span class="sql-keyword">ADD PARTITION</span> TAB1_202601 
<span class="sql-keyword">VALUES</span> (<span class="sql-string">'202601'</span>)
<span class="sql-keyword">TABLESPACE</span> ts_2026;</code></pre>
            </div>

            <h3>2Ô∏è‚É£ Rimuovere Partizione (Dati Vecchi)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Rimuove partizione e TUTTI i dati in essa</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">DROP PARTITION</span> TAB1_202401;

<span class="sql-comment">-- Rimuove pi√π partizioni</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">DROP PARTITION</span> TAB1_202401;
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">DROP PARTITION</span> TAB1_202402;
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">DROP PARTITION</span> TAB1_202403;</code></pre>
            </div>

            <div class="note-box warning">
                <strong>‚ö†Ô∏è ATTENZIONE:</strong><br>
                DROP PARTITION cancella PERMANENTEMENTE tutti i dati in quella partizione!<br>
                Fai sempre un backup prima!
            </div>

            <h3>3Ô∏è‚É£ Truncate Partizione (Svuota Senza Rimuovere)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Rimuove tutti i dati ma mantiene la partizione</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">TRUNCATE PARTITION</span> TAB1_202409;</code></pre>
            </div>

            <h3>4Ô∏è‚É£ Rinominare Partizione</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">ALTER TABLE</span> TAB1 
<span class="sql-keyword">RENAME PARTITION</span> TAB1_202409 
<span class="sql-keyword">TO</span> TAB1_2024_Q3;</code></pre>
            </div>

            <h3>5Ô∏è‚É£ Split Partizione (Dividere una Partizione)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Divide una partizione in due (esempio trimestrale ‚Üí mensile)</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 
<span class="sql-keyword">SPLIT PARTITION</span> TAB1_Q1_2024 
<span class="sql-keyword">VALUES</span> (<span class="sql-string">'202401'</span>, <span class="sql-string">'202402'</span>)
<span class="sql-keyword">INTO</span> (
    <span class="sql-keyword">PARTITION</span> TAB1_202401,
    <span class="sql-keyword">PARTITION</span> TAB1_202403
);</code></pre>
            </div>

            <h3>6Ô∏è‚É£ Merge Partizioni (Unire Partizioni)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Unisce pi√π partizioni in una (Oracle 12c+)</span>
<span class="sql-keyword">ALTER TABLE</span> TAB1 
<span class="sql-keyword">MERGE PARTITIONS</span> TAB1_202401, TAB1_202402, TAB1_202403
<span class="sql-keyword">INTO PARTITION</span> TAB1_Q1_2024;</code></pre>
            </div>

            <h3>7Ô∏è‚É£ Statistiche per Partizione</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Raccoglie statistiche su singola partizione (pi√π veloce)</span>
<span class="sql-keyword">EXEC</span> DBMS_STATS.GATHER_TABLE_STATS(
    ownname => <span class="sql-string">'SCHEMA_NAME'</span>,
    tabname => <span class="sql-string">'TAB1'</span>,
    partname => <span class="sql-string">'TAB1_202409'</span>
);</code></pre>
            </div>
        </div>

        <!-- Query Utili -->
        <div class="note-section">
            <h2>üìä Query Utili per Gestione Partizioni</h2>

            <h3>1Ô∏è‚É£ Lista Tutte le Partizioni</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">SELECT</span> 
    partition_name,
    partition_position,
    high_value,
    num_rows,
    <span class="sql-keyword">ROUND</span>(bytes/<span class="sql-number">1024</span>/<span class="sql-number">1024</span>, <span class="sql-number">2</span>) <span class="sql-keyword">AS</span> size_mb,
    tablespace_name
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
<span class="sql-keyword">ORDER BY</span> partition_position;</code></pre>
            </div>

            <h3>2Ô∏è‚É£ Dimensione Totale per Anno</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">SELECT</span> 
    <span class="sql-keyword">SUBSTR</span>(partition_name, <span class="sql-number">-6</span>, <span class="sql-number">4</span>) <span class="sql-keyword">AS</span> anno,
    <span class="sql-keyword">COUNT</span>(*) <span class="sql-keyword">AS</span> num_partizioni,
    <span class="sql-keyword">SUM</span>(num_rows) <span class="sql-keyword">AS</span> totale_righe,
    <span class="sql-keyword">ROUND</span>(<span class="sql-keyword">SUM</span>(bytes)/<span class="sql-number">1024</span>/<span class="sql-number">1024</span>/<span class="sql-number">1024</span>, <span class="sql-number">2</span>) <span class="sql-keyword">AS</span> size_gb
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
<span class="sql-keyword">GROUP BY</span> <span class="sql-keyword">SUBSTR</span>(partition_name, <span class="sql-number">-6</span>, <span class="sql-number">4</span>)
<span class="sql-keyword">ORDER BY</span> anno;</code></pre>
            </div>

            <h3>3Ô∏è‚É£ Partizioni Vuote (Candidati per DROP)</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">SELECT</span> partition_name, high_value
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
  <span class="sql-keyword">AND</span> (num_rows = <span class="sql-number">0</span> <span class="sql-keyword">OR</span> num_rows <span class="sql-keyword">IS NULL</span>)
<span class="sql-keyword">ORDER BY</span> partition_position;</code></pre>
            </div>

            <h3>4Ô∏è‚É£ Verifica Partizione per Valore</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- In quale partizione finir√† questo record?</span>
<span class="sql-keyword">SELECT</span> partition_name
<span class="sql-keyword">FROM</span> user_tab_partitions
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'TAB1'</span>
  <span class="sql-keyword">AND</span> high_value = <span class="sql-string">'''202409'''</span>;</code></pre>
            </div>

            <h3>5Ô∏è‚É£ Query su Partizione Specifica</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">Oracle SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-comment">-- Forza Oracle ad usare una partizione specifica</span>
<span class="sql-keyword">SELECT</span> *
<span class="sql-keyword">FROM</span> TAB1 <span class="sql-keyword">PARTITION</span> (TAB1_202409)
<span class="sql-keyword">WHERE</span> <span class="sql-keyword">ROWNUM</span> &lt;= <span class="sql-number">100</span>;</code></pre>
            </div>
        </div>

        <!-- Script Automatico -->
        <div class="note-section">
            <h2>ü§ñ Script PL/SQL Automatico</h2>
            <p>Per creare partizioni per un anno intero automaticamente:</p>

            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">PL/SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">DECLARE</span>
    v_anno <span class="sql-keyword">NUMBER</span> := <span class="sql-number">2025</span>; <span class="sql-comment">-- Anno da creare</span>
    v_sql <span class="sql-keyword">VARCHAR2</span>(<span class="sql-number">500</span>);
    v_partition_name <span class="sql-keyword">VARCHAR2</span>(<span class="sql-number">50</span>);
    v_partition_value <span class="sql-keyword">VARCHAR2</span>(<span class="sql-number">6</span>);
<span class="sql-keyword">BEGIN</span>
    <span class="sql-comment">-- Loop per ogni mese (01-12)</span>
    <span class="sql-keyword">FOR</span> i <span class="sql-keyword">IN</span> <span class="sql-number">1</span>..<span class="sql-number">12</span> <span class="sql-keyword">LOOP</span>
        <span class="sql-comment">-- Formatta mese a 2 cifre (01, 02, ...)</span>
        v_partition_value := v_anno || <span class="sql-keyword">LPAD</span>(i, <span class="sql-number">2</span>, <span class="sql-string">'0'</span>);
        v_partition_name := <span class="sql-string">'TAB1_'</span> || v_partition_value;
        
        <span class="sql-comment">-- Costruisce comando ALTER TABLE</span>
        v_sql := <span class="sql-string">'ALTER TABLE TAB1 '</span> ||
                 <span class="sql-string">'ADD PARTITION '</span> || v_partition_name ||
                 <span class="sql-string">' VALUES ('''</span> || v_partition_value || <span class="sql-string">''')'</span>;
        
        <span class="sql-comment">-- Esegue comando</span>
        <span class="sql-keyword">EXECUTE IMMEDIATE</span> v_sql;
        
        <span class="sql-keyword">DBMS_OUTPUT</span>.PUT_LINE(<span class="sql-string">'Creata partizione: '</span> || v_partition_name);
    <span class="sql-keyword">END LOOP</span>;
    
    <span class="sql-keyword">COMMIT</span>;
    <span class="sql-keyword">DBMS_OUTPUT</span>.PUT_LINE(<span class="sql-string">'Completato! Create '</span> || <span class="sql-number">12</span> || <span class="sql-string">' partizioni per '</span> || v_anno);
<span class="sql-keyword">EXCEPTION</span>
    <span class="sql-keyword">WHEN OTHERS THEN</span>
        <span class="sql-keyword">DBMS_OUTPUT</span>.PUT_LINE(<span class="sql-string">'Errore: '</span> || <span class="sql-keyword">SQLERRM</span>);
        <span class="sql-keyword">ROLLBACK</span>;
<span class="sql-keyword">END</span>;
/</code></pre>
            </div>

            <h3>Script per Creare Multi-Anno:</h3>
            <div class="code-block">
                <div class="code-header">
                    <span class="code-language">PL/SQL</span>
                    <button class="copy-btn" onclick="copyCode(this)">üìã Copia</button>
                </div>
                <pre><code><span class="sql-keyword">BEGIN</span>
    <span class="sql-comment">-- Crea partizioni dal 2024 al 2026</span>
    <span class="sql-keyword">FOR</span> anno <span class="sql-keyword">IN</span> <span class="sql-number">2024</span>..<span class="sql-number">2026</span> <span class="sql-keyword">LOOP</span>
        <span class="sql-keyword">FOR</span> mese <span class="sql-keyword">IN</span> <span class="sql-number">1</span>..<span class="sql-number">12</span> <span class="sql-keyword">LOOP</span>
            <span class="sql-keyword">EXECUTE IMMEDIATE</span> 
                <span class="sql-string">'ALTER TABLE TAB1 ADD PARTITION TAB1_'</span> || 
                anno || <span class="sql-keyword">LPAD</span>(mese, <span class="sql-number">2</span>, <span class="sql-string">'0'</span>) ||
                <span class="sql-string">' VALUES ('''</span> || anno || <span class="sql-keyword">LPAD</span>(mese, <span class="sql-number">2</span>, <span class="sql-string">'0'</span>) || <span class="sql-string">''')'</span>;
        <span class="sql-keyword">END LOOP</span>;
    <span class="sql-keyword">END LOOP</span>;
<span class="sql-keyword">END</span>;
/</code></pre>
            </div>
        </div>

        <!-- Note Importanti -->
        <div class="note-section">
            <h2>üìù Note Importanti</h2>

            <div class="note-box warning">
                <strong>‚ö†Ô∏è Formato Valore Partizione:</strong><br>
                Il valore deve essere una STRINGA tra apici: <code>VALUES ('202409')</code><br>
                Deve corrispondere ESATTAMENTE al valore nella colonna di partizione.
            </div>

            <div class="note-box info">
                <strong>üí° Convenzione Nomi:</strong><br>
                Usa nome partizione = nome_tabella + valore per chiarezza:<br>
                <code>TAB1_202409</code> invece di <code>P09</code> o <code>SEP2024</code>
            </div>

            <div class="note-box success">
                <strong>‚úÖ Verifica Prima di DROP:</strong><br>
                Prima di droppare partizioni vecchie, verifica sempre:<br>
                1. Backup eseguito<br>
                2. Dati non pi√π necessari<br>
                3. Query non usano quelle partizioni
            </div>

            <div class="note-box warning">
                <strong>‚ö†Ô∏è Indici su Partizioni:</strong><br>
                Gli indici possono essere:<br>
                - <strong>Global</strong>: Un indice per tutta la tabella<br>
                - <strong>Local</strong>: Un indice per ogni partizione<br>
                Quando aggiungi partizione, indici local vengono creati automaticamente.
            </div>

            <div class="note-box info">
                <strong>üí° Performance Tuning:</strong><br>
                Raccogli statistiche dopo aver aggiunto partizioni:<br>
                <code>EXEC DBMS_STATS.GATHER_TABLE_STATS('SCHEMA','TAB1');</code>
            </div>

            <div class="note-box success">
                <strong>‚úÖ Manutenzione Programmata:</strong><br>
                Crea job schedulato per aggiungere partizioni future:<br>
                - Fine anno: crea partizioni anno successivo<br>
                - Fine trimestre: verifica e prepara partizioni prossimi mesi
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="note-section">
            <h2>üîß Troubleshooting</h2>

            <h3>Errore: "ORA-14006: invalid partition name"</h3>
            <p><strong>Causa:</strong> Nome partizione gi√† esistente</p>
            <p><strong>Soluzione:</strong> Verifica partizioni esistenti con query su user_tab_partitions</p>

            <h3>Errore: "ORA-14400: inserted partition key does not map to any partition"</h3>
            <p><strong>Causa:</strong> Inserisci un valore che non ha partizione corrispondente</p>
            <p><strong>Soluzione:</strong> Crea partizione per quel valore o aggiungi DEFAULT PARTITION</p>

            <h3>Errore: "ORA-14402: updating partition key column would cause a partition change"</h3>
            <p><strong>Causa:</strong> Tentativo di UPDATE sulla colonna di partizione</p>
            <p><strong>Soluzione:</strong> DELETE + INSERT invece di UPDATE, oppure abilita ROW MOVEMENT:</p>
            <div class="code-block">
                <pre><code><span class="sql-keyword">ALTER TABLE</span> TAB1 <span class="sql-keyword">ENABLE ROW MOVEMENT</span>;</code></pre>
            </div>

            <h3>Partizioni Create ma Query Lente</h3>
            <p><strong>Causa:</strong> Statistiche non aggiornate</p>
            <p><strong>Soluzione:</strong></p>
            <div class="code-block">
                <pre><code><span class="sql-keyword">EXEC</span> DBMS_STATS.GATHER_TABLE_STATS(<span class="sql-string">'SCHEMA_NAME'</span>, <span class="sql-string">'TAB1'</span>);</code></pre>
            </div>
        </div>

        <!-- Link Correlati -->
        <div class="note-section">
            <h2>üîó Appunti Correlati</h2>
            <ul>
                <li><a href="create-partition-table.html">Creare Tabella Partizionata</a></li>
                <li><a href="partition-pruning.html">Partition Pruning e Performance</a></li>
                <li><a href="partition-maintenance.html">Manutenzione Partizioni</a></li>
                <li><a href="dba-tab-partitions.html">Viste Data Dictionary Partizioni</a></li>
            </ul>
        </div>

    </main>

    <script src="../script.js"></script>
    <script src="../theme-toggle.js"></script>
</body>
</html>
